# ============================================
# rKYC Backend Environment Variables
# Copy this file to .env and fill in your values
# ============================================

# Application
APP_NAME=rKYC
APP_VERSION=1.0.0
ENVIRONMENT=development
DEBUG=true
LOG_LEVEL=INFO

# Server
HOST=0.0.0.0
PORT=8000

# Supabase Database (Tokyo ap-northeast-1)
# Format: postgresql://postgres.[PROJECT_REF]:[PASSWORD]@aws-1-ap-northeast-1.pooler.supabase.com:6543/postgres?sslmode=require
# Get from: Supabase Dashboard → Settings → Database → Connection String (Transaction pooler)
# IMPORTANT: Use Transaction Pooler (pooler.supabase.com), NOT Direct (db.xxx.supabase.co)
DATABASE_URL=postgresql://postgres.YOUR_PROJECT_REF:YOUR_PASSWORD@aws-1-ap-northeast-1.pooler.supabase.com:6543/postgres?sslmode=require
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
DB_ECHO=false

# Supabase API (for Auth)
# Get from: Supabase Dashboard → Settings → API
SUPABASE_URL=https://YOUR_PROJECT_REF.supabase.co
SUPABASE_ANON_KEY=your_supabase_anon_key_here
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key_here

# Redis (for Celery Worker)
REDIS_URL=redis://localhost:6379/0
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/1

# Circuit Breaker Redis 설정 (P1-5 문서화)
# - 프로덕션에서는 CIRCUIT_BREAKER_REQUIRE_REDIS=true (기본값) 권장
# - Redis 연결 실패 시 Worker가 시작되지 않음 (의도된 동작)
# - 개발 환경에서만 false로 설정하여 in-memory 모드 사용 가능
# WARNING: in-memory 모드는 Worker 재시작 시 Circuit Breaker 상태 손실
CIRCUIT_BREAKER_REQUIRE_REDIS=true

# CORS Origins (comma-separated)
CORS_ORIGINS=http://localhost:5173,http://localhost:3000,https://rkyc.vercel.app

# LLM API Keys (Worker only - NOT for Backend API!)
# NOTE: Backend API server should NOT have these keys
# These environment variables are ONLY used by the Worker component
ANTHROPIC_API_KEY=your_anthropic_api_key_here
OPENAI_API_KEY=your_openai_api_key_here
GOOGLE_API_KEY=your_google_api_key_here

# ============================================
# 검색 내장 LLM 2-Track (Perplexity + Gemini)
# ============================================
# Primary: Perplexity (실시간 검색 + AI 요약)
PERPLEXITY_API_KEY=your_perplexity_api_key_here

# Fallback: Gemini Grounding (GOOGLE_API_KEY 활용)
# → 위의 GOOGLE_API_KEY가 이미 설정되어 있으면 자동으로 사용됨

# 검색 Provider 우선순위
# 사용 가능: perplexity, gemini_grounding (OpenAI/Claude는 검색 불가)
SEARCH_PROVIDER_PRIORITY=perplexity,gemini_grounding

# 병렬 검색 모드 (true: Perplexity + Gemini 동시 검색)
MULTI_SEARCH_PARALLEL_MODE=false

# ============================================
# API 키 로테이션 (Rate Limit 대응)
# ============================================
# 다중 키 사용 시 라운드 로빈 + 실패 시 자동 전환
# 주의: 같은 결제 계정의 키는 Rate Limit 공유될 수 있음

# Perplexity 다중 키 (최대 3개)
PERPLEXITY_API_KEY_1=your_perplexity_key_1
PERPLEXITY_API_KEY_2=your_perplexity_key_2
PERPLEXITY_API_KEY_3=your_perplexity_key_3

# Google/Gemini 다중 키 (최대 3개)
GOOGLE_API_KEY_1=your_google_key_1
GOOGLE_API_KEY_2=your_google_key_2
GOOGLE_API_KEY_3=your_google_key_3

# 키 로테이션 설정
KEY_ROTATION_ENABLED=true
KEY_ROTATION_FAILURE_COOLDOWN=300  # 실패한 키 5분간 제외

# Rate Limiting
RATE_LIMIT_PER_MINUTE=60

# ============================================
# DART OpenAPI (주주 정보 검증)
# ============================================
# DART: 금융감독원 전자공시시스템 (https://opendart.fss.or.kr)
# API 키 발급: https://opendart.fss.or.kr/intro/main.do → API 인증키 신청

# DART API 인증키 (40자리)
DART_API_KEY=your_dart_api_key_here

# 2-Source Verification 활성화 여부
# true: Perplexity 주주 정보를 DART 공시와 교차 검증
# false: Perplexity 데이터만 사용 (검증 없음)
DART_VERIFICATION_ENABLED=true
